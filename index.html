<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linear Algebra JS Example</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/13.1.1/math.min.js"></script>
    <script src="svd.js"></script>
    <script src="calibrate-debevec.js"></script>

</head>
<body>
    <h1>Linear Algebra JS Example</h1>

    <!-- Input element to select multiple JPEG files -->
    <input type="file" id="imageInput" accept="image/jpeg" multiple>

    <!-- Container to display matrices -->
    <div id="matrixContainer"></div>

    <script type="module">

        function pToDiv(arrayOfArrays, divId) {
    const div = document.getElementById(divId);
    if (div && Array.isArray(arrayOfArrays)) {
        div.innerHTML = ""; // Clear existing content
        arrayOfArrays.forEach(subArray => {
            if (Array.isArray(subArray)) {
                const p = document.createElement("p");
                p.textContent = subArray.join(", "); // Join sub-array elements with commas
                div.appendChild(p);
            }
        });
    } else {
        console.error("Invalid div ID or array format");
    }
}

        
        // Event listener for file input changes
        document.getElementById('imageInput').addEventListener('change', function(event) {
            const files = event.target.files;

            // Clear previous matrices
            const container = document.getElementById('matrixContainer');
            container.innerHTML = '';

            const imagesPromises = [];
            const images = [];

            // Iterate over selected files
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                imagesPromises.push(fileObjectToImageRgb(file));
            }

            Promise.all(imagesPromises).then(imageRgbArray => {
                // Push each processed image into the images array
                imageRgbArray.forEach(imageRgb => {
                    console.log(imageRgb.array.length);
                    images.push(imageRgb);
                });

                // Now, all images are in the array, and we can proceed
                let c = new CalibrateDebevec();
                r = c.process(images, [0.0125, 0.0250, 0.05]);
                console.log(r);
                pToDiv(r, 'matrixContainer');
            });

            // let c = new CalibrateDebevec();
            // c.process(images, []);
        });
    </script>
</body>
</html>
